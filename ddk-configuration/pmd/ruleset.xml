<?xml version="1.0" encoding="UTF-8"?>
<ruleset xmlns="http://pmd.sourceforge.net/ruleset/2.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         name="Tools PMD ruleset"
         xsi:schemaLocation="http://pmd.sourceforge.net/ruleset/2.0.0 http://pmd.sourceforge.net/ruleset_2_0_0.xsd">

  <description>Avaloq Tools PMD ruleset</description>

  <!-- Exclude default folders for generated files from analysis -->
  <exclude-pattern>.*/src-gen/.*</exclude-pattern>
  <exclude-pattern>.*/src-model/.*</exclude-pattern>
  <exclude-pattern>.*/xtend-gen/.*</exclude-pattern>
  <exclude-pattern>.*/ddk/xtext/test/ui/quickfix/AbstractQuickFixTest.*</exclude-pattern>

  <rule ref="category/java/errorprone.xml">
    <exclude name="AssignmentInOperand"/><!--Checkstyle-->
    <exclude name="AssignmentToNonFinalStatic"/>
    <exclude name="AvoidAccessibilityAlteration"/>
    <exclude name="AvoidBranchingStatementAsLastInLoop"/>
    <exclude name="AvoidCatchingThrowable"/><!--Checkstyle-->
    <exclude name="AvoidDuplicateLiterals"/><!--Checkstyle-->
    <exclude name="AvoidLiteralsInIfCondition"/><!--Checkstyle-->
    <exclude name="CloneMethodMustImplementCloneable"/>
    <exclude name="CloseResource"/>
    <exclude name="CompareObjectsWithEquals"/>
    <exclude name="ConstructorCallsOverridableMethod"/>
    <exclude name="DataflowAnomalyAnalysis"/>
    <exclude name="DetachedTestCase"/>
    <exclude name="DontImportSun"/><!--Checkstyle-->
    <exclude name="DoNotTerminateVM"/>
    <exclude name="EmptyCatchBlock"/><!--Checkstyle-->
    <exclude name="EmptyFinallyBlock"/><!--Checkstyle-->
    <exclude name="EmptyIfStmt"/><!--Checkstyle-->
    <exclude name="EmptyInitializer"/><!--Checkstyle-->
    <exclude name="EmptyStatementNotInLoop"/><!--Checkstyle-->
    <exclude name="EmptyInitializer"/><!--Checkstyle-->
    <exclude name="EmptySwitchStatements"/><!--Checkstyle-->
    <exclude name="EmptyTryBlock"/><!--Checkstyle-->
    <exclude name="EmptyWhileStmt"/><!--Checkstyle-->
    <exclude name="ImportFromSamePackage"/><!--Eclipse-->
    <exclude name="JumbledIncrementer"/><!--Checkstyle-->
    <exclude name="NullAssignment"/>
    <exclude name="SingleMethodSingleton"/>
    <exclude name="UseEqualsToCompareStrings"/><!--Checkstyle-->
    <exclude name="UseLocaleWithCaseConversions"/>
    <exclude name="UseProperClassLoader"/>
    <exclude name="ProperCloneImplementation"/><!--Checkstyle-->
    <exclude name="TestClassWithoutTestCases"/>
  </rule>
  <rule ref="category/java/multithreading.xml">
    <exclude name="AvoidSynchronizedAtMethodLevel"/>
    <exclude name="DoNotUseThreads"/>
    <exclude name="UseConcurrentHashMap"/><!--New after PMD 5.3 upgrade, but not intelligent enough-->
  </rule>
  <rule ref="category/java/design.xml">
    <exclude name="AvoidCatchingGenericException"/><!--Checkstyle-->
    <exclude name="AvoidDeeplyNestedIfStmts"/>
    <exclude name="AvoidRethrowingException"/>
    <exclude name="AvoidUncheckedExceptionsInSignatures"/>
    <exclude name="DataClass"/>
    <exclude name="DoNotExtendJavaLangError"/>
    <exclude name="ExcessiveImports"/>
    <exclude name="ExcessiveMethodLength"/>
    <exclude name="ClassWithOnlyPrivateConstructorsShouldBeFinal"/><!--Checkstyle-->
    <exclude name="CognitiveComplexity"/>
    <exclude name="CyclomaticComplexity"/>
    <exclude name="GodClass"/><!--New after PMD 5.3 upgrade, not to be activated by default-->
    <exclude name="LawOfDemeter"/><!--New after PMD 5.3 upgrade, too many markers (50'000+), too late to change-->
    <exclude name="LoosePackageCoupling"/>
    <exclude name="ModifiedCyclomaticComplexity"/><!--New after PMD 5.3 upgrade, see CyclomaticComplexity-->
    <exclude name="MutableStaticState"/>
    <exclude name="NcssCount"/>
    <exclude name="NcssMethodCount"/>
    <exclude name="NPathComplexity"/><!--Checkstyle-->
    <exclude name="StdCyclomaticComplexity"/><!--New after PMD 5.3 upgrade, see CyclomaticComplexity-->
    <exclude name="SimplifyBooleanExpressions"/><!--Checkstyle-->
    <exclude name="TooManyFields"/>
    <exclude name="TooManyMethods"/>
    <exclude name="UseUtilityClass"/>
  </rule>
  <rule ref="category/java/bestpractices.xml">
    <exclude name="AbstractClassWithoutAbstractMethod"/>
    <exclude name="ArrayIsStoredDirectly"/>
    <exclude name="AccessorMethodGeneration"/>
    <exclude name="AvoidReassigningParameters"/>
    <exclude name="UnusedPrivateMethod"/><!-- false positives-->
    <exclude name="DefaultLabelNotLastInSwitchStmt"/>
    <exclude name="ForLoopCanBeForeach"/>
    <exclude name="GuardLogStatement"/><!--TODO-->
    <exclude name="JUnitTestContainsTooManyAsserts"/><!--New after PMD 5.3 upgrade, limitation to 1 assert not sensible, would need customization, disabled for the time being-->
    <exclude name="JUnitTestsShouldIncludeAssert"/>
    <exclude name="JUnit4TestShouldUseAfterAnnotation"/><!--Checkstyle-->
    <exclude name="JUnit4TestShouldUseBeforeAnnotation"/><!--Checkstyle-->
    <exclude name="JUnit4TestShouldUseTestAnnotation"/>
    <exclude name="SwitchStmtsShouldHaveDefault"/>
    <exclude name="PreserveStackTrace"/><!--TODO-->
    <exclude name="UnusedLocalVariable"/><!--Checkstyle-->
    <exclude name="UseTryWithResources"/><!--TODO-->
  </rule>
  <rule ref="category/java/codestyle.xml">
    <exclude name="AbstractNaming"/><!--Checkstyle-->
    <exclude name="AtLeastOneConstructor"/>
    <exclude name="AvoidFinalLocalVariable"/>
    <exclude name="AvoidPrefixingMethodParameters"/><!--New after PMD 5.3 upgrade, only false positives-->
    <exclude name="CallSuperInConstructor"/>
    <exclude name="ClassNamingConventions"/>
    <exclude name="CommentDefaultAccessModifier"/>
    <exclude name="ConfusingTernary"/>
    <exclude name="ControlStatementBraces"/><!--Checkstyle-->
    <exclude name="DefaultPackage"/>
    <exclude name="DontImportJavaLang"/><!--Eclipse-->
    <exclude name="DuplicateImports"/><!--Eclipse-->
    <exclude name="EmptyMethodInAbstractClassShouldBeAbstract"/>
    <exclude name="FieldDeclarationsShouldBeAtStartOfClass"/>
    <exclude name="FieldNamingConventions"/>
    <exclude name="IdenticalCatchBranches"/>
    <exclude name="LinguisticNaming"/>
    <exclude name="LocalVariableCouldBeFinal"/> <!--  not sensible -->
    <exclude name="LongVariable"/> <!--  not sensible -->
    <exclude name="MethodNamingConventions"/>
    <exclude name="NoPackage"/><!--Checkstyle-->
    <exclude name="OnlyOneReturn"/>
    <exclude name="ShortClassName"/><!--New after PMD 5.3 upgrade, not sensible/only false positives-->
    <exclude name="ShortVariable"/> <!--  not sensible -->
    <exclude name="SuspiciousConstantFieldName"/><!--Checkstyle-->
    <exclude name="TooManyStaticImports"/>
    <exclude name="UnnecessaryAnnotationValueElement"/>
    <exclude name="UnnecessaryModifier"/><!--Checkstyle-->
    <exclude name="UnnecessaryFullyQualifiedName"/>
    <exclude name="UnnecessaryLocalBeforeReturn"/>
    <exclude name="UselessParentheses"/><!--New after PMD 5.3 upgrade, impairs readability, not needed because of Formatter-->
    <exclude name="UselessQualifiedThis"/>
    <exclude name="UseDiamondOperator"/>
    <exclude name="UseShortArrayInitializer"/>
    <exclude name="UseUnderscoresInNumericLiterals"/>
  </rule>
  <rule ref="category/java/performance.xml">
    <exclude name="AvoidFileStream"/>
    <exclude name="AvoidInstantiatingObjectsInLoops"/>
    <exclude name="ConsecutiveAppendsShouldReuse"/><!--New after PMD 5.3 upgrade, many markers (1'000+), performance gain uncertain, impairs readability-->
    <exclude name="ConsecutiveLiteralAppends"/>
    <exclude name="OptimizableToArrayCall"/>
    <exclude name="RedundantFieldInitializer"/><!--Checkstyle-->
    <exclude name="TooFewBranchesForASwitchStatement"/>
  </rule>

  <rule
      language="java"
      name="MissingBreakOrReturnInSwitch"
      message="A switch statement does not contain a break or return statement"
      class="net.sourceforge.pmd.lang.rule.XPathRule"
      dfa="false"
      typeResolution="true">
    <description>A switch statement without an enclosed break or return statement may be a bug.</description>
    <priority>3</priority>
    <properties>
      <property name="xpath">
        <value>
          <![CDATA[
//SwitchStatement
[count(SwitchLabel) > 0]
[count(.//BreakStatement)+count(.//ReturnStatement)=0]
[count(BlockStatement/Statement/ReturnStatement)
 + count(BlockStatement/Statement/ThrowStatement)
     < count (SwitchLabel)]
]]>
        </value>
      </property>
    </properties>
    <example><![CDATA[
public class Foo {
  public void bar(int status) {
    switch(status) {
      case CANCELLED:
        doCancelled();
        // break; hm, should this be commented out?
      case NEW:
        doNew();
      case REMOVED:
        doRemoved();
    }
  }
}
]]>
    </example>
  </rule>

  <rule
      language="java"
      name="BeforeAfterClassStatic"
      message="Methods annotated with @BeforeClass or @AfterClass need to be static."
      class="net.sourceforge.pmd.lang.rule.XPathRule"
      dfa="false"
      typeResolution="true">
    <description>Test methods annotated with @BeforeClass or @AfterClass need to be static.</description>
    <priority>3</priority>
    <properties>
      <property name="xpath">
        <value>
          <![CDATA[
//ClassOrInterfaceBodyDeclaration[Annotation/MarkerAnnotation/Name[@Image='BeforeClass' or @Image='AfterClass']]
[count(MethodDeclaration[@Static='true'])=0]]]>
        </value>
      </property>
    </properties>
    <example>
      <![CDATA[
]]>
    </example>
  </rule>

  <rule
      language="java"
      name="BeforeAfterNotStatic"
      message="Methods annotated with @Before or @After must not be static."
      class="net.sourceforge.pmd.lang.rule.XPathRule"
      dfa="false"
      typeResolution="true">
    <description>Test methods annotated with @Before or @After must not be static.</description>
    <priority>3</priority>
    <properties>
      <property name="xpath">
        <value>
          <![CDATA[
//ClassOrInterfaceBodyDeclaration[Annotation/MarkerAnnotation/Name[@Image='Before' or @Image='After']]
[count(MethodDeclaration[@Static='false'])=0]]]>
        </value>
      </property>
    </properties>
    <example>
      <![CDATA[
]]>
    </example>
  </rule>

</ruleset>
